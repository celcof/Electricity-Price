% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={prepS},
  pdfauthor={Francesco Cabras},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering

\title{prepS}
\author{Francesco Cabras}
\date{12 May 2020}

\begin{document}
\maketitle

\begin{verbatim}
## Loading required package: ggplot2
\end{verbatim}

\begin{verbatim}
## Loading required package: carData
\end{verbatim}

\begin{verbatim}
## Loading required package: lattice
\end{verbatim}

\begin{verbatim}
## Loading required package: Matrix
\end{verbatim}

\begin{verbatim}
## Loaded glmnet 4.0-2
\end{verbatim}

\begin{verbatim}
## hash-2.2.6.1 provided by Decision Patterns
\end{verbatim}

Take data from library eurostat. Start from the dependent variable.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X \textless{}{-}}\StringTok{ }\KeywordTok{get\_eurostat}\NormalTok{(}\StringTok{"nrg\_pc\_204"}\NormalTok{, }\DataTypeTok{time\_format =} \StringTok{"num"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Table nrg_pc_204 cached at C:\Users\FRANCE~1\AppData\Local\Temp\RtmpAvsUzX/eurostat/nrg_pc_204_num_code_FF.rds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{consom }\OperatorTok{==}\StringTok{ "4161903"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{tax }\OperatorTok{==}\StringTok{ "X\_TAX"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{currency }\OperatorTok{==}\StringTok{ "EUR"}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\DecValTok{6}\OperatorTok{:}\DecValTok{8}\NormalTok{)]}
\NormalTok{X \textless{}{-}}\StringTok{ }\NormalTok{X[}\OperatorTok{!}\NormalTok{(X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "EA"} \OperatorTok{|}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "EU27\_2020"} \OperatorTok{|}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "EU28"}\NormalTok{),]}
\NormalTok{X}\OperatorTok{$}\NormalTok{time \textless{}{-}}\StringTok{ }\KeywordTok{as.character}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(X}\OperatorTok{$}\NormalTok{time))}
\KeywordTok{names}\NormalTok{(X)[}\DecValTok{3}\NormalTok{] \textless{}{-}}\StringTok{ "PRI"}
\NormalTok{X}\OperatorTok{$}\NormalTok{time \textless{}{-}}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(X}\OperatorTok{$}\NormalTok{time))}
\NormalTok{X}\OperatorTok{$}\NormalTok{geo \textless{}{-}}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(X}\OperatorTok{$}\NormalTok{geo))}
\end{Highlighting}
\end{Shaded}

Price of natural gas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\KeywordTok{get\_eurostat}\NormalTok{(}\StringTok{"nrg\_pc\_202"}\NormalTok{, }\DataTypeTok{time\_format =} \StringTok{"num"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Table nrg_pc_202 cached at C:\Users\FRANCE~1\AppData\Local\Temp\RtmpAvsUzX/eurostat/nrg_pc_202_num_code_FF.rds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[I}\OperatorTok{$}\NormalTok{consom }\OperatorTok{==}\StringTok{ "4141902"} \OperatorTok{\&}\StringTok{ }\NormalTok{I}\OperatorTok{$}\NormalTok{tax }\OperatorTok{==}\StringTok{ "X\_TAX"} \OperatorTok{\&}\StringTok{ }\NormalTok{I}\OperatorTok{$}\NormalTok{currency }\OperatorTok{==}\StringTok{ "EUR"} \OperatorTok{\&}\StringTok{ }\NormalTok{I}\OperatorTok{$}\NormalTok{unit}\OperatorTok{==}\StringTok{ "GJ\_GCV"}\NormalTok{,}\KeywordTok{c}\NormalTok{(}\DecValTok{6}\OperatorTok{:}\DecValTok{8}\NormalTok{)]}
\KeywordTok{names}\NormalTok{(I)[}\DecValTok{3}\NormalTok{] \textless{}{-}}\StringTok{ "GAS"}
\NormalTok{X \textless{}{-}}\StringTok{ }\KeywordTok{merge}\NormalTok{(X, I, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\StringTok{"geo"}\NormalTok{), }\DataTypeTok{all.x=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trying to get more data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\KeywordTok{get\_eurostat}\NormalTok{(}\StringTok{"nrg\_pc\_204\_h"}\NormalTok{, }\DataTypeTok{time\_format =} \StringTok{"num"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Table nrg_pc_204_h cached at C:\Users\FRANCE~1\AppData\Local\Temp\RtmpAvsUzX/eurostat/nrg_pc_204_h_num_code_FF.rds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{J \textless{}{-}}\StringTok{ }\KeywordTok{get\_eurostat}\NormalTok{(}\StringTok{"nrg\_pc\_202\_h"}\NormalTok{, }\DataTypeTok{time\_format =} \StringTok{"num"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Table nrg_pc_202_h cached at C:\Users\FRANCE~1\AppData\Local\Temp\RtmpAvsUzX/eurostat/nrg_pc_202_h_num_code_FF.rds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[I}\OperatorTok{$}\NormalTok{tax }\OperatorTok{==}\StringTok{ "X\_TAX"} \OperatorTok{\&}\StringTok{ }\NormalTok{I}\OperatorTok{$}\NormalTok{currency }\OperatorTok{==}\StringTok{ "EUR"} \OperatorTok{\&}\StringTok{ }\NormalTok{I}\OperatorTok{$}\NormalTok{unit }\OperatorTok{==}\StringTok{ "KWH"} \OperatorTok{\&}\StringTok{ }\NormalTok{I}\OperatorTok{$}\NormalTok{consom }\OperatorTok{==}\StringTok{ "4161150"}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\DecValTok{6}\OperatorTok{:}\DecValTok{8}\NormalTok{)]}
\NormalTok{J \textless{}{-}}\StringTok{ }\NormalTok{J[J}\OperatorTok{$}\NormalTok{tax }\OperatorTok{==}\StringTok{ "X\_TAX"} \OperatorTok{\&}\StringTok{ }\NormalTok{J}\OperatorTok{$}\NormalTok{currency }\OperatorTok{==}\StringTok{ "EUR"} \OperatorTok{\&}\StringTok{ }\NormalTok{J}\OperatorTok{$}\NormalTok{unit}\OperatorTok{==}\StringTok{ "GJ\_GCV"} \OperatorTok{\&}\StringTok{ }\NormalTok{J}\OperatorTok{$}\NormalTok{consom }\OperatorTok{==}\StringTok{ "4141150"}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\DecValTok{6}\OperatorTok{:}\DecValTok{8}\NormalTok{)]}
\KeywordTok{names}\NormalTok{(I)[}\DecValTok{3}\NormalTok{] \textless{}{-}}\StringTok{ "PRI"}
\KeywordTok{names}\NormalTok{(J)[}\DecValTok{3}\NormalTok{] \textless{}{-}}\StringTok{ "GAS"}
\NormalTok{I \textless{}{-}}\StringTok{ }\KeywordTok{merge}\NormalTok{(I, J, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\StringTok{"geo"}\NormalTok{), }\DataTypeTok{all.x=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{countries \textless{}{-}}\StringTok{ }\KeywordTok{levels}\NormalTok{(X}\OperatorTok{$}\NormalTok{geo)}
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[I}\OperatorTok{$}\NormalTok{time }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{2007} \OperatorTok{\&}\StringTok{ }\NormalTok{I}\OperatorTok{$}\NormalTok{geo }\OperatorTok{\%in\%}\StringTok{ }\NormalTok{countries,]}
\NormalTok{X \textless{}{-}}\StringTok{ }\KeywordTok{rbind}\NormalTok{(X, I)}
\NormalTok{X \textless{}{-}}\StringTok{ }\NormalTok{X[}\KeywordTok{order}\NormalTok{(X}\OperatorTok{$}\NormalTok{time),]}
\end{Highlighting}
\end{Shaded}

We take only data from 2000 on.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{time }\OperatorTok{\textgreater{}=}\StringTok{ }\DecValTok{2000}\NormalTok{,]}
\end{Highlighting}
\end{Shaded}

Dependency from imports.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\KeywordTok{get\_eurostat}\NormalTok{(}\StringTok{"nrg\_ind\_id"}\NormalTok{, }\DataTypeTok{time\_format =} \StringTok{"num"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Table nrg_ind_id cached at C:\Users\FRANCE~1\AppData\Local\Temp\RtmpAvsUzX/eurostat/nrg_ind_id_num_code_FF.rds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[}\KeywordTok{grep}\NormalTok{(}\StringTok{"TOTAL"}\NormalTok{, I}\OperatorTok{$}\NormalTok{siec), ]}
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[,}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\OperatorTok{:}\DecValTok{5}\NormalTok{)]}
\KeywordTok{names}\NormalTok{(I)[}\DecValTok{3}\NormalTok{] \textless{}{-}}\StringTok{ "DEP"}
\NormalTok{X \textless{}{-}}\StringTok{ }\KeywordTok{merge}\NormalTok{(X, I, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\StringTok{"geo"}\NormalTok{), }\DataTypeTok{all.x=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Consumption of electricity per capita.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\KeywordTok{get\_eurostat}\NormalTok{(}\StringTok{"sdg\_07\_20"}\NormalTok{, }\DataTypeTok{time\_format =} \StringTok{"num"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Table sdg_07_20 cached at C:\Users\FRANCE~1\AppData\Local\Temp\RtmpAvsUzX/eurostat/sdg_07_20_num_code_FF.rds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[, }\DecValTok{{-}1}\NormalTok{]}
\KeywordTok{names}\NormalTok{(I)[}\DecValTok{3}\NormalTok{] \textless{}{-}}\StringTok{ "CON"}
\NormalTok{X \textless{}{-}}\StringTok{ }\KeywordTok{merge}\NormalTok{(X, I, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\StringTok{"geo"}\NormalTok{), }\DataTypeTok{all.x=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Inflation indicator. It is monthly data so we have to subset it.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\KeywordTok{get\_eurostat}\NormalTok{(}\StringTok{"ei\_cphi\_m"}\NormalTok{, }\DataTypeTok{time\_format =} \StringTok{"num"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Table ei_cphi_m cached at C:\Users\FRANCE~1\AppData\Local\Temp\RtmpAvsUzX/eurostat/ei_cphi_m_num_code_FF.rds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[I}\OperatorTok{$}\NormalTok{indic }\OperatorTok{==}\StringTok{ "CP{-}HI00"} \OperatorTok{\&}\StringTok{ }\NormalTok{I}\OperatorTok{$}\NormalTok{unit }\OperatorTok{==}\StringTok{ "HICP2015"}\NormalTok{, ]}
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[, }\OperatorTok{{-}}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{)]}
\KeywordTok{names}\NormalTok{(I)[}\DecValTok{3}\NormalTok{] \textless{}{-}}\StringTok{ "INF"}
\NormalTok{X \textless{}{-}}\StringTok{ }\KeywordTok{merge}\NormalTok{(X, I, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\StringTok{"geo"}\NormalTok{), }\DataTypeTok{all.x=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Emissions intensity.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\KeywordTok{get\_eurostat}\NormalTok{(}\StringTok{"sdg\_13\_20"}\NormalTok{, }\DataTypeTok{time\_format =} \StringTok{"num"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Table sdg_13_20 cached at C:\Users\FRANCE~1\AppData\Local\Temp\RtmpAvsUzX/eurostat/sdg_13_20_num_code_FF.rds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[,}\OperatorTok{{-}}\DecValTok{1}\NormalTok{]}
\KeywordTok{names}\NormalTok{(I)[}\DecValTok{3}\NormalTok{] \textless{}{-}}\StringTok{ "EMI"}
\NormalTok{X \textless{}{-}}\StringTok{ }\KeywordTok{merge}\NormalTok{(X, I, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\StringTok{"geo"}\NormalTok{), }\DataTypeTok{all.x=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Share of largest electricity generator in the market.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\KeywordTok{get\_eurostat}\NormalTok{(}\StringTok{"nrg\_ind\_331a"}\NormalTok{, }\DataTypeTok{time\_format =} \StringTok{"num"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Table nrg_ind_331a cached at C:\Users\FRANCE~1\AppData\Local\Temp\RtmpAvsUzX/eurostat/nrg_ind_331a_num_code_FF.rds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[,}\KeywordTok{c}\NormalTok{(}\DecValTok{4}\OperatorTok{:}\DecValTok{6}\NormalTok{)]}
\KeywordTok{names}\NormalTok{(I)[}\DecValTok{3}\NormalTok{] \textless{}{-}}\StringTok{ "MAR"}
\NormalTok{X \textless{}{-}}\StringTok{ }\KeywordTok{merge}\NormalTok{(X, I, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\StringTok{"geo"}\NormalTok{), }\DataTypeTok{all.x=}\OtherTok{TRUE}\NormalTok{)}
\KeywordTok{rm}\NormalTok{(I, J)}
\end{Highlighting}
\end{Shaded}

Share of energy from renewable sources, (in percentage) in consumption.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\KeywordTok{get\_eurostat}\NormalTok{(}\StringTok{"nrg\_ind\_ren"}\NormalTok{, }\DataTypeTok{time\_format =} \StringTok{"num"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Table nrg_ind_ren cached at C:\Users\FRANCE~1\AppData\Local\Temp\RtmpAvsUzX/eurostat/nrg_ind_ren_num_code_FF.rds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[I}\OperatorTok{$}\NormalTok{nrg\_bal }\OperatorTok{==}\StringTok{ "REN"}\NormalTok{, ]}
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[, }\OperatorTok{{-}}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)]}
\KeywordTok{names}\NormalTok{(I)[}\DecValTok{3}\NormalTok{] \textless{}{-}}\StringTok{ "REN"}
\NormalTok{U \textless{}{-}}\StringTok{ }\NormalTok{I}
\end{Highlighting}
\end{Shaded}

However, we are missing data from the time range 2000-2003. In this
sense, we can make use of data from world bank to fill the gap. Both
data sets should represent the same information, e.g.~for data regarding
2004, they are almost equivalent: however, just pasting data belonging
to two different data sets could be dangerous so we decide to normalize
the world bank information multiplying each country value for 2000-2003
by a factor that makes eurostat and WB information match.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{J \textless{}{-}}\StringTok{ }\KeywordTok{wb}\NormalTok{(}\DataTypeTok{indicator =} \StringTok{"EG.FEC.RNEW.ZS"}\NormalTok{, }\DataTypeTok{startdate =} \DecValTok{2000}\NormalTok{, }\DataTypeTok{enddate =} \DecValTok{2004}\NormalTok{, }\DataTypeTok{country=}\KeywordTok{c}\NormalTok{(}\KeywordTok{levels}\NormalTok{(X}\OperatorTok{$}\NormalTok{geo), }\StringTok{"GB"}\NormalTok{, }\StringTok{"GR"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: `wb()` is deprecated as of wbstats 1.0.0.
## Please use `wb_data()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.
\end{verbatim}

\begin{verbatim}
## Warning in wb(indicator = "EG.FEC.RNEW.ZS", startdate = 2000, enddate = 2004, :
## The following country values are not valid and are being excluded from the
## request: EL,UK
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{J}\OperatorTok{$}\NormalTok{iso2c \textless{}{-}}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\StringTok{"GB"}\NormalTok{, }\StringTok{"UK"}\NormalTok{, J}\OperatorTok{$}\NormalTok{iso2c)}
\NormalTok{J}\OperatorTok{$}\NormalTok{iso2c \textless{}{-}}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\StringTok{"GR"}\NormalTok{, }\StringTok{"EL"}\NormalTok{, J}\OperatorTok{$}\NormalTok{iso2c)}
\NormalTok{J \textless{}{-}}\StringTok{ }\NormalTok{J[,}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{6}\NormalTok{)]}
\KeywordTok{names}\NormalTok{(J) \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\StringTok{"WBren"}\NormalTok{, }\StringTok{"geo"}\NormalTok{)}
\NormalTok{I \textless{}{-}}\StringTok{ }\KeywordTok{merge}\NormalTok{(I, J, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\StringTok{"geo"}\NormalTok{))}
\NormalTok{I}\OperatorTok{$}\NormalTok{FAC \textless{}{-}}\StringTok{ }\NormalTok{I}\OperatorTok{$}\NormalTok{REN }\OperatorTok{/}\StringTok{ }\NormalTok{I}\OperatorTok{$}\NormalTok{WBren}
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[,}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{5}\NormalTok{)]}
\NormalTok{J \textless{}{-}}\StringTok{ }\KeywordTok{merge}\NormalTok{(J, I, }\DataTypeTok{by=}\StringTok{"geo"}\NormalTok{)}
\NormalTok{J}\OperatorTok{$}\NormalTok{REN \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(J}\OperatorTok{$}\NormalTok{WBren }\OperatorTok{*}\StringTok{ }\NormalTok{J}\OperatorTok{$}\NormalTok{FAC, }\DecValTok{3}\NormalTok{)}
\NormalTok{J \textless{}{-}}\StringTok{ }\NormalTok{J[J}\OperatorTok{$}\NormalTok{time }\OperatorTok{\textless{}}\StringTok{ }\DecValTok{2004}\NormalTok{, }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{5}\NormalTok{)]}
\NormalTok{U \textless{}{-}}\StringTok{ }\KeywordTok{rbind}\NormalTok{(U, J)}
\NormalTok{X \textless{}{-}}\StringTok{ }\KeywordTok{merge}\NormalTok{(X, U, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\StringTok{"geo"}\NormalTok{), }\DataTypeTok{all.x=}\OtherTok{TRUE}\NormalTok{)}
\KeywordTok{rm}\NormalTok{(U, J)}
\end{Highlighting}
\end{Shaded}

Real GDP per capita.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\KeywordTok{get\_eurostat}\NormalTok{(}\StringTok{"namq\_10\_pc"}\NormalTok{, }\DataTypeTok{time\_format =} \StringTok{"num"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Table namq_10_pc cached at C:\Users\FRANCE~1\AppData\Local\Temp\RtmpAvsUzX/eurostat/namq_10_pc_num_code_FF.rds
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[I}\OperatorTok{$}\NormalTok{na\_item }\OperatorTok{==}\StringTok{ "B1GQ"} \OperatorTok{\&}\StringTok{ }\NormalTok{I}\OperatorTok{$}\NormalTok{unit }\OperatorTok{==}\StringTok{ "CP\_EUR\_HAB"}\NormalTok{, ]}
\NormalTok{I \textless{}{-}}\StringTok{ }\NormalTok{I[, }\OperatorTok{{-}}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)]}
\KeywordTok{names}\NormalTok{(I)[}\DecValTok{3}\NormalTok{] \textless{}{-}}\StringTok{ "GDP"}
\NormalTok{X \textless{}{-}}\StringTok{ }\KeywordTok{merge}\NormalTok{(X, I, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{, }\StringTok{"geo"}\NormalTok{), }\DataTypeTok{all.x=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Oil Price. Data taken from
www.investing.com/commodities/brent-oil-historical-data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OIL \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{58.58}\NormalTok{, }\FloatTok{53.79}\NormalTok{, }\FloatTok{68.76}\NormalTok{, }\FloatTok{64.73}\NormalTok{, }\FloatTok{50.17}\NormalTok{, }\FloatTok{52.81}\NormalTok{, }\FloatTok{41.6}\NormalTok{, }\FloatTok{33.62}\NormalTok{, }\FloatTok{47.12}\NormalTok{, }\FloatTok{48.24}\NormalTok{, }\FloatTok{98.17}\NormalTok{, }\FloatTok{97.49}\NormalTok{, }\FloatTok{105.03}\NormalTok{, }\FloatTok{97.49}\NormalTok{, }\FloatTok{88.06}\NormalTok{, }\FloatTok{98.48}\NormalTok{, }\FloatTok{95.7}\NormalTok{, }\FloatTok{92.19}\NormalTok{, }\FloatTok{78.95}\NormalTok{, }\FloatTok{72.89}\NormalTok{, }\FloatTok{69.45}\NormalTok{, }\FloatTok{41.68}\NormalTok{, }\FloatTok{124.08}\NormalTok{, }\FloatTok{91.75}\NormalTok{, }\FloatTok{78.21}\NormalTok{, }\FloatTok{58.14}\NormalTok{, }\FloatTok{74.4}\NormalTok{, }\FloatTok{67.92}\NormalTok{, }\FloatTok{60.57}\NormalTok{, }\FloatTok{48.2}\NormalTok{, }\FloatTok{43.8}\NormalTok{, }\FloatTok{33.05}\NormalTok{, }\FloatTok{30.54}\NormalTok{, }\FloatTok{33.51}\NormalTok{, }\FloatTok{27.02}\NormalTok{, }\FloatTok{19.48}\NormalTok{, }\FloatTok{26.35}\NormalTok{, }\FloatTok{28.66}\NormalTok{, }\FloatTok{27.43}\NormalTok{, }\FloatTok{27.64}\NormalTok{)}
\NormalTok{time \textless{}{-}}\StringTok{ }\KeywordTok{rev}\NormalTok{(}\KeywordTok{levels}\NormalTok{(}\KeywordTok{as.factor}\NormalTok{(X}\OperatorTok{$}\NormalTok{time)))}
\NormalTok{OIL \textless{}{-}}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(OIL, time)}
\NormalTok{X \textless{}{-}}\StringTok{ }\KeywordTok{merge}\NormalTok{(X, OIL, }\DataTypeTok{by=}\KeywordTok{c}\NormalTok{(}\StringTok{"time"}\NormalTok{), }\DataTypeTok{all.x=}\OtherTok{TRUE}\NormalTok{)}
\KeywordTok{rm}\NormalTok{(OIL, time, countries, I)}
\end{Highlighting}
\end{Shaded}

substitute NA for Market Concentration

of Bulgaria. we miss values until 2012: we just substitute with first
value available (2013)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "BG"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2000}\OperatorTok{:}\DecValTok{2012}\NormalTok{), }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "BG"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2013}\NormalTok{, }\StringTok{"MAR"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

Of Germany. goes from 28.4 in 2010 to 32.0 in 2013. we expect linear
behaviour

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{in2011 \textless{}{-}}\StringTok{ }\FloatTok{28.4} \OperatorTok{+}\StringTok{ }\NormalTok{(}\DecValTok{32} \OperatorTok{{-}}\StringTok{ }\FloatTok{28.4}\NormalTok{) }\OperatorTok{/}\StringTok{ }\DecValTok{3}
\NormalTok{in2012 \textless{}{-}}\StringTok{ }\NormalTok{in2011 }\OperatorTok{+}\StringTok{ }\NormalTok{(}\DecValTok{32} \OperatorTok{{-}}\StringTok{ }\FloatTok{28.4}\NormalTok{) }\OperatorTok{/}\StringTok{ }\DecValTok{3}
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "DE"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2011}\NormalTok{, }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{in2011}
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "DE"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2012}\NormalTok{, }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{in2012}
\KeywordTok{rm}\NormalTok{(in2011, in2012)}
\end{Highlighting}
\end{Shaded}

Of Greece. in 2011, average between previous and subsequent years.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "EL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2011}\NormalTok{, }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "EL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2010}\NormalTok{, }\StringTok{"MAR"}\NormalTok{], X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "EL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2012}\NormalTok{, }\StringTok{"MAR"}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

Of Luxembourg. We miss values until 2009: we just substitute with first
value available (2010)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "LU"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2000}\OperatorTok{:}\DecValTok{2009}\NormalTok{), }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "LU"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2010}\NormalTok{, }\StringTok{"MAR"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

Of Austria. We miss values until 2010: we just substitute with first
value available (2011). Also miss values from 2014 on. substitute with
ones from 2013

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "AT"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2000}\OperatorTok{:}\DecValTok{2010}\NormalTok{), }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "AT"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2011}\NormalTok{, }\StringTok{"MAR"}\NormalTok{]}
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "AT"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2014}\OperatorTok{:}\DecValTok{2018}\NormalTok{), }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "AT"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2013}\NormalTok{, }\StringTok{"MAR"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

Of Netherlands: average year values from Belgium, Luxembourg and
Germany. Also take a look at
\url{https://www.sciencedirect.com/science/article/pii/S0301421518308061}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(X)) \{}
\NormalTok{  year \textless{}{-}}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time[i]}
  \ControlFlowTok{if}\NormalTok{ (X}\OperatorTok{$}\NormalTok{geo[i] }\OperatorTok{==}\StringTok{ "NL"} \OperatorTok{\&}\StringTok{ }\NormalTok{year}\OperatorTok{\%\%}\DecValTok{1}\OperatorTok{==}\DecValTok{0}\NormalTok{)\{}
\NormalTok{    DEvalue \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "DE"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"MAR"}\NormalTok{]}
\NormalTok{    BEvalue \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "BE"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"MAR"}\NormalTok{]}
\NormalTok{    LUvalue \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "LU"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"MAR"}\NormalTok{]}
\NormalTok{    DKvalue \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "DK"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"MAR"}\NormalTok{]}
\NormalTok{    NLvalue \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(DEvalue, BEvalue, LUvalue, DKvalue), }\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{    X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "NL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{NLvalue}
\NormalTok{  \}}
\NormalTok{  X}\OperatorTok{$}\NormalTok{MAR \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(X}\OperatorTok{$}\NormalTok{MAR,}\DecValTok{1}\NormalTok{)}
\NormalTok{\}}
\KeywordTok{rm}\NormalTok{(DEvalue, BEvalue, LUvalue, DKvalue, NLvalue, i, year)}
\end{Highlighting}
\end{Shaded}

Of UK we miss values from 2014 on. substitute with ones from 2013.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "UK"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2014}\OperatorTok{:}\DecValTok{2018}\NormalTok{), }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "UK"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2013}\NormalTok{, }\StringTok{"MAR"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

Finally, sub na for EMI 2018 and following the trend from 2016 and 2017
(value 2017 + t(value 2017 - value 2016)) with some inertia t (=1/3).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X}\OperatorTok{$}\NormalTok{geo \textless{}{-}}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(X}\OperatorTok{$}\NormalTok{geo))}
\ControlFlowTok{for}\NormalTok{ (country }\ControlFlowTok{in} \KeywordTok{levels}\NormalTok{(X}\OperatorTok{$}\NormalTok{geo))\{}
  \ControlFlowTok{if}\NormalTok{ (country }\OperatorTok{!=}\StringTok{ "GE"}\NormalTok{) \{}
\NormalTok{  diff \textless{}{-}}\StringTok{ }\NormalTok{(X[X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2017} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ }\NormalTok{country, }\StringTok{"EMI"}\NormalTok{] }\OperatorTok{{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2016} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ }\NormalTok{country, }\StringTok{"EMI"}\NormalTok{])}
\NormalTok{  X[X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2018} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ }\NormalTok{country, }\StringTok{"EMI"}\NormalTok{] \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2017} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ }\NormalTok{country, }\StringTok{"EMI"}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{diff }\OperatorTok{/}\StringTok{ }\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{  X[X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2019} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ }\NormalTok{country, }\StringTok{"EMI"}\NormalTok{] \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2017} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ }\NormalTok{country, }\StringTok{"EMI"}\NormalTok{] }\OperatorTok{+}\StringTok{ }\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{diff }\OperatorTok{/}\StringTok{ }\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{) \}}
\NormalTok{\}}
\KeywordTok{rm}\NormalTok{(country, diff)}
\end{Highlighting}
\end{Shaded}

Missing gas values. 25\% of the value comes from the average of the
country price and 75\% from the average of the price from all countries
for the year. This choice because empirically seen that, in general,
prices increased over time.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(X}\OperatorTok{$}\NormalTok{GAS), X}\OperatorTok{$}\NormalTok{geo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        
##         AL AT BA BE BG CY CZ DE DK EE EL ES FI FR GE HR HU IE IS IT LI LT LU LV
##   FALSE  0 39 19 38 31  0 39 39 39 32 14 38  0 39  4 30 39 39  0 33  7 31 38 31
##   TRUE  15  0  0  1  0 37  1  1  0  1 25  0 39  0  0  0  0  0 16  0  1  0  2  0
##        
##         MD ME MK MT NL NO PL PT RO RS SE SI SK TR UA UK XK
##   FALSE 10  0  5  0 40  0 37 36 29 14 40 39 31 25  7 39  0
##   TRUE   0 17  9 39  0 39  1  2  0  0  0  0  0  0  0  0 14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(X)) \{}
\NormalTok{  year \textless{}{-}}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time[i]}
\NormalTok{  country \textless{}{-}}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo[i]}
  \ControlFlowTok{if}\NormalTok{ (country }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"BE"}\NormalTok{, }\StringTok{"CZ"}\NormalTok{, }\StringTok{"DE"}\NormalTok{, }\StringTok{"EE"}\NormalTok{, }\StringTok{"EL"}\NormalTok{, }\StringTok{"LI"}\NormalTok{, }\StringTok{"LU"}\NormalTok{, }\StringTok{"MK"}\NormalTok{, }\StringTok{"PL"}\NormalTok{, }\StringTok{"PT"}\NormalTok{) }\OperatorTok{\&}\StringTok{ }\KeywordTok{is.na}\NormalTok{(X[i, }\StringTok{"GAS"}\NormalTok{])) \{}
\NormalTok{      X[i, }\StringTok{"GAS"}\NormalTok{] \textless{}{-}}\StringTok{ }\KeywordTok{weighted.mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\NormalTok{country,}\StringTok{"GAS"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T),}\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{time}\OperatorTok{==}\NormalTok{year,}\StringTok{"GAS"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T)),}\KeywordTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{,}\FloatTok{0.75}\NormalTok{))}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Not available gas price of cyprus. We use year average between greece
and turkey for political and geographical reasons. Not available gas
price for kosovo, albania and montenegro. Substituted with year average
between bosnia, greece, croatia, north macedonia, serbia. Not available
gas price for iceland, norway and finland. Substituted with year average
between sweden, uk, denmark, estonia. Finally, malta substituted with
time average of italy and greece.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(X)) \{}
\NormalTok{  year \textless{}{-}}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time[i]}
  \ControlFlowTok{if}\NormalTok{ (X}\OperatorTok{$}\NormalTok{geo[i] }\OperatorTok{==}\StringTok{ "CY"}\NormalTok{) \{}
\NormalTok{    value1 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "TR"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value2 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "EL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(value1, value2), }\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{    X[i,}\StringTok{"GAS"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{value}
\NormalTok{  \}}
  \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (X}\OperatorTok{$}\NormalTok{geo[i] }\OperatorTok{==}\StringTok{ "XK"} \OperatorTok{|}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo[i] }\OperatorTok{==}\StringTok{ "AL"} \OperatorTok{|}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo[i] }\OperatorTok{==}\StringTok{ "ME"}\NormalTok{) \{}
\NormalTok{    value1 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "EL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value2 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "HR"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value3 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "MK"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value4 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "RS"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value5 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "BA"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(value1, value2, value3, value4, value5), }\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{    X[i,}\StringTok{"GAS"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{value}
\NormalTok{  \}}
  \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (X}\OperatorTok{$}\NormalTok{geo[i] }\OperatorTok{==}\StringTok{ "FI"} \OperatorTok{|}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo[i] }\OperatorTok{==}\StringTok{ "IS"} \OperatorTok{|}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo[i] }\OperatorTok{==}\StringTok{ "NO"}\NormalTok{) \{}
\NormalTok{    value1 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "UK"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value2 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "SE"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value3 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "DK"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value4 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "EE"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(value1, value2, value3, value4), }\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{    X[i,}\StringTok{"GAS"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{value}
\NormalTok{  \}}
  \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (X}\OperatorTok{$}\NormalTok{geo[i] }\OperatorTok{==}\StringTok{ "MT"}\NormalTok{) \{}
\NormalTok{    value1 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "IT"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value2 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "EL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GAS"}\NormalTok{]}
\NormalTok{    value \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(value1, value2), }\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{    X[i,}\StringTok{"GAS"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{value}
\NormalTok{  \}}
\NormalTok{\}}
\NormalTok{X}\OperatorTok{$}\NormalTok{MAR \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(X}\OperatorTok{$}\NormalTok{MAR,}\DecValTok{1}\NormalTok{)}
\KeywordTok{rm}\NormalTok{(value2, value1, value, i, year, value3, value4, value5, country)}
\end{Highlighting}
\end{Shaded}

Not Availables for Dependencies, Consumption, Inflation, Emissions
Intensity.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(X}\OperatorTok{$}\NormalTok{INF), X}\OperatorTok{$}\NormalTok{geo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        
##         AL AT BA BE BG CY CZ DE DK EE EL ES FI FR GE HR HU IE IS IT LI LT LU LV
##   FALSE  0 39  0 39 31 37 40 40 39 33 39 38 39 39  0 30 39 39 16 33  0 31 40 31
##   TRUE  15  0 19  0  0  0  0  0  0  0  0  0  0  0  4  0  0  0  0  0  8  0  0  0
##        
##         MD ME MK MT NL NO PL PT RO RS SE SI SK TR UA UK XK
##   FALSE  0  0 14 39 40 39 38 38 29 14 40 39 31 25  0 39  0
##   TRUE  10 17  0  0  0  0  0  0  0  0  0  0  0  0  7  0 14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(X)) \{}
\NormalTok{  year \textless{}{-}}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time[i]}
\NormalTok{  country \textless{}{-}}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo[i]}
  \ControlFlowTok{if}\NormalTok{ ((}\KeywordTok{is.na}\NormalTok{(X[i, }\StringTok{"DEP"}\NormalTok{]) }\OperatorTok{\&}\StringTok{ }\NormalTok{year}\OperatorTok{\%\%}\DecValTok{1}\OperatorTok{==}\DecValTok{0} \OperatorTok{\&}\StringTok{ }\NormalTok{year }\OperatorTok{!=}\StringTok{ }\DecValTok{2019}\NormalTok{)) \{}
\NormalTok{      X[i, }\StringTok{"DEP"}\NormalTok{] \textless{}{-}}\StringTok{ }\KeywordTok{weighted.mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\NormalTok{country,}\StringTok{"DEP"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T),}\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{time}\OperatorTok{==}\NormalTok{year,}\StringTok{"DEP"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T)),}\KeywordTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{,}\FloatTok{0.75}\NormalTok{),}\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{      \}}
  \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (year }\OperatorTok{==}\StringTok{ }\DecValTok{2019}\NormalTok{) \{}
\NormalTok{      prevYear \textless{}{-}}\StringTok{ }\NormalTok{(year }\OperatorTok{{-}}\StringTok{ }\DecValTok{1}\NormalTok{)}
\NormalTok{      X[i, }\StringTok{"DEP"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ }\NormalTok{country }\OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{prevYear, }\StringTok{"DEP"}\NormalTok{]}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ ((}\KeywordTok{is.na}\NormalTok{(X[i, }\StringTok{"CON"}\NormalTok{]) }\OperatorTok{\&}\StringTok{ }\NormalTok{year}\OperatorTok{\%\%}\DecValTok{1}\OperatorTok{==}\DecValTok{0} \OperatorTok{\&}\StringTok{ }\NormalTok{year }\OperatorTok{!=}\StringTok{ }\DecValTok{2019}\NormalTok{)) \{}
\NormalTok{      X[i, }\StringTok{"CON"}\NormalTok{] \textless{}{-}}\StringTok{ }\KeywordTok{weighted.mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\NormalTok{country,}\StringTok{"CON"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T),}\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{time}\OperatorTok{==}\NormalTok{year,}\StringTok{"CON"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T)),}\KeywordTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{,}\FloatTok{0.75}\NormalTok{),}\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{      \}}
  \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (year }\OperatorTok{==}\StringTok{ }\DecValTok{2019}\NormalTok{) \{}
\NormalTok{      prevYear \textless{}{-}}\StringTok{ }\NormalTok{(year }\OperatorTok{{-}}\StringTok{ }\DecValTok{1}\NormalTok{)}
\NormalTok{      X[i, }\StringTok{"CON"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ }\NormalTok{country }\OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{prevYear, }\StringTok{"CON"}\NormalTok{]}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{is.na}\NormalTok{(X[i, }\StringTok{"INF"}\NormalTok{])) \{}
\NormalTok{      X[i, }\StringTok{"INF"}\NormalTok{] \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{weighted.mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\NormalTok{country,}\StringTok{"INF"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T),}\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{time}\OperatorTok{==}\NormalTok{year,}\StringTok{"INF"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T)),}\KeywordTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{,}\FloatTok{0.75}\NormalTok{),}\DataTypeTok{na.rm=}\NormalTok{T),}\DecValTok{2}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ ((}\KeywordTok{is.na}\NormalTok{(X[i, }\StringTok{"EMI"}\NormalTok{]) }\OperatorTok{\&}\StringTok{ }\NormalTok{year}\OperatorTok{\%\%}\DecValTok{1}\OperatorTok{==}\DecValTok{0}\NormalTok{)) \{}
\NormalTok{      X[i, }\StringTok{"EMI"}\NormalTok{] \textless{}{-}}\StringTok{ }\KeywordTok{weighted.mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\NormalTok{country,}\StringTok{"EMI"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T),}\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{time}\OperatorTok{==}\NormalTok{year,}\StringTok{"EMI"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T)),}\KeywordTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{,}\FloatTok{0.75}\NormalTok{),}\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ ((}\KeywordTok{is.na}\NormalTok{(X[i, }\StringTok{"REN"}\NormalTok{]) }\OperatorTok{\&}\StringTok{ }\NormalTok{year}\OperatorTok{\%\%}\DecValTok{1}\OperatorTok{==}\DecValTok{0} \OperatorTok{\&}\StringTok{ }\NormalTok{year }\OperatorTok{!=}\StringTok{ }\DecValTok{2019}\NormalTok{)) \{}
\NormalTok{      X[i, }\StringTok{"REN"}\NormalTok{] \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{weighted.mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\NormalTok{country,}\StringTok{"REN"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T),}\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{time}\OperatorTok{==}\NormalTok{year,}\StringTok{"REN"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T)),}\KeywordTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{,}\FloatTok{0.75}\NormalTok{),}\DataTypeTok{na.rm=}\NormalTok{T))}
\NormalTok{      \}}
  \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (year }\OperatorTok{==}\StringTok{ }\DecValTok{2019}\NormalTok{) \{}
\NormalTok{      prevYear \textless{}{-}}\StringTok{ }\NormalTok{(year }\OperatorTok{{-}}\StringTok{ }\DecValTok{1}\NormalTok{)}
\NormalTok{      X[i, }\StringTok{"REN"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ }\NormalTok{country }\OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{prevYear, }\StringTok{"REN"}\NormalTok{]}
\NormalTok{  \}}
  
\NormalTok{\}}
\KeywordTok{rm}\NormalTok{(year, country, prevYear)}
\end{Highlighting}
\end{Shaded}

For GDP better to be more careful. The countries that lack information
lack it for all the years, so doesn't make sense to use weighted
average. We use information from economically close regions. However,
pure average does not work because for certain time steps, data is not
available for all countries, and the situation becomes unstable. so to
stabilize we use previous information from that countries (slightly
positive adjusted, because especially for eastern europe countries GDP
per capita tended to increase over time).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(X}\OperatorTok{$}\NormalTok{MAR), X}\OperatorTok{$}\NormalTok{geo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        
##         AL AT BA BE BG CY CZ DE DK EE EL ES FI FR GE HR HU IE IS IT LI LT LU LV
##   FALSE  0 18  6 18 14 18 19 19 18 16 18 18 18 18  0 14 18 18  0 15  0 14 19 14
##   TRUE  15 21 13 21 17 19 21 21 21 17 21 20 21 21  4 16 21 21 16 18  8 17 21 17
##        
##         MD ME MK MT NL NO PL PT RO RS SE SI SK TR UA UK XK
##   FALSE  4  6  6 18 19 18 17 18 13  6 19 16 14  0  0 18  6
##   TRUE   6 11  8 21 21 21 21 20 16  8 21 23 17 25  7 21  8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{historic1 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{()}
\NormalTok{historic2 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(X)) \{}
\NormalTok{  year \textless{}{-}}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time[i]}
\NormalTok{  country \textless{}{-}}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo[i]}
  \ControlFlowTok{if}\NormalTok{ (country }\OperatorTok{==}\StringTok{ "XK"} \OperatorTok{|}\StringTok{ }\NormalTok{country }\OperatorTok{==}\StringTok{ "AL"} \OperatorTok{|}\StringTok{ }\NormalTok{country }\OperatorTok{==}\StringTok{ "ME"} \OperatorTok{|}\StringTok{ }\NormalTok{country }\OperatorTok{==}\StringTok{ "MK"} \OperatorTok{|}\StringTok{ }\NormalTok{country }\OperatorTok{==}\StringTok{ "BA"}\NormalTok{) \{}
\NormalTok{    value1 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "RO"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GDP"}\NormalTok{]}
\NormalTok{    value2 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "HR"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GDP"}\NormalTok{]}
\NormalTok{    value3 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "RS"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GDP"}\NormalTok{]}
\NormalTok{    value4 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "BG"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GDP"}\NormalTok{]}
\NormalTok{    outside \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(value1, value2, value3, value4),}\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{    value \textless{}{-}}\StringTok{ }\KeywordTok{weighted.mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(outside,}\FloatTok{1.01}\OperatorTok{*}\KeywordTok{mean}\NormalTok{(historic1)),}\DataTypeTok{w=}\KeywordTok{c}\NormalTok{(}\FloatTok{0.0005}\NormalTok{,}\FloatTok{0.9995}\NormalTok{),}\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{    historic1 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(historic1, value)}
\NormalTok{    X[i,}\StringTok{"GDP"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{value}
\NormalTok{  \}}
  \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (country }\OperatorTok{==}\StringTok{ "MD"} \OperatorTok{|}\StringTok{ }\NormalTok{country }\OperatorTok{==}\StringTok{ "GE"} \OperatorTok{|}\StringTok{ }\NormalTok{country }\OperatorTok{==}\StringTok{ "TR"} \OperatorTok{|}\StringTok{ }\NormalTok{country }\OperatorTok{==}\StringTok{ "UA"}\NormalTok{ ) \{}
\NormalTok{    value1 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "RS"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GDP"}\NormalTok{]}
\NormalTok{    value2 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "RO"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GDP"}\NormalTok{]}
\NormalTok{    value3 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "PL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GDP"}\NormalTok{]}
\NormalTok{    value4 \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "BG"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GDP"}\NormalTok{]}
\NormalTok{    outside \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(value1, value2, value3, value4),}\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{    value \textless{}{-}}\StringTok{ }\KeywordTok{weighted.mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(outside,}\FloatTok{1.01}\OperatorTok{*}\KeywordTok{mean}\NormalTok{(historic2)),}\DataTypeTok{w=}\KeywordTok{c}\NormalTok{(}\FloatTok{0.0005}\NormalTok{,}\FloatTok{0.9995}\NormalTok{),}\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{    historic2 \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(historic2, value)}
\NormalTok{    X[i,}\StringTok{"GDP"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{value}
\NormalTok{  \}}
  \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (country }\OperatorTok{==}\StringTok{ "LI"}\NormalTok{) \{}
\NormalTok{    X[i,}\StringTok{"GDP"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "AT"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\NormalTok{year, }\StringTok{"GDP"}\NormalTok{]}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in mean.default(historic2): argument is not numeric or logical:
## returning NA
\end{verbatim}

\begin{verbatim}
## Warning in mean.default(historic1): argument is not numeric or logical:
## returning NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rm}\NormalTok{(value2, value1, value, i, year, value3, value4, country)}
\end{Highlighting}
\end{Shaded}

Finally, market concentration. We miss all values from 2019. Just
substitute with ones from 2018. For countries with few observations in
general and no MAR record we are just going to use year average (not
many better options).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(X}\OperatorTok{$}\NormalTok{MAR) }\OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{\%\%}\StringTok{ }\DecValTok{1} \OperatorTok{==}\StringTok{ }\DecValTok{0} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{!=}\DecValTok{2019}\NormalTok{, X}\OperatorTok{$}\NormalTok{geo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        
##         AL AT BA BE BG CY CZ DE DK EE EL ES FI FR GE HR HU IE IS IT LI LT LU LV
##   FALSE  8 39 16 39 31 37 40 40 39 33 39 38 39 39  3 30 39 39  9 33  4 31 40 31
##   TRUE   7  0  3  0  0  0  0  0  0  0  0  0  0  0  1  0  0  0  7  0  4  0  0  0
##        
##         MD ME MK MT NL NO PL PT RO RS SE SI SK TR UA UK XK
##   FALSE 10 15 14 39 40 39 38 38 29 14 40 37 31 14  4 39 14
##   TRUE   0  2  0  0  0  0  0  0  0  0  0  2  0 11  3  0  0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(X)) \{}
\NormalTok{  year \textless{}{-}}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time[i]}
\NormalTok{  country \textless{}{-}}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo[i]}
  \ControlFlowTok{if}\NormalTok{ (country }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"AL"}\NormalTok{, }\StringTok{"GE"}\NormalTok{, }\StringTok{"IS"}\NormalTok{, }\StringTok{"LI"}\NormalTok{, }\StringTok{"LU"}\NormalTok{, }\StringTok{"TR"}\NormalTok{, }\StringTok{"UA"}\NormalTok{)) \{}
\NormalTok{      X[i, }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(X[X}\OperatorTok{$}\NormalTok{time}\OperatorTok{==}\NormalTok{year,}\StringTok{"MAR"}\NormalTok{],}\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (year }\OperatorTok{==}\StringTok{ }\DecValTok{2019}\NormalTok{) \{}
\NormalTok{    X[i, }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2018} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ }\NormalTok{country, }\StringTok{"MAR"}\NormalTok{]}
\NormalTok{  \}}
\NormalTok{\}}

\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "BA"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2010}\OperatorTok{:}\DecValTok{2012}\NormalTok{), }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "BA"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2013}\NormalTok{, }\StringTok{"MAR"}\NormalTok{]}

\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "ME"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2011}\OperatorTok{:}\DecValTok{2012}\NormalTok{), }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "ME"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2013}\NormalTok{, }\StringTok{"MAR"}\NormalTok{]}

\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "SI"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{2000}\OperatorTok{:}\DecValTok{2001}\NormalTok{), }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo }\OperatorTok{==}\StringTok{ "SI"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2002}\NormalTok{, }\StringTok{"MAR"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

Now, time to fill mid-year values for features missing. First we work
with countries that do have all year values for electricity price.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(X}\OperatorTok{$}\NormalTok{geo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## AL AT BA BE BG CY CZ DE DK EE EL ES FI FR GE HR HU IE IS IT LI LT LU LV MD ME 
## 15 39 19 39 31 37 40 40 39 33 39 38 39 39  4 30 39 39 16 33  8 31 40 31 10 17 
## MK MT NL NO PL PT RO RS SE SI SK TR UA UK XK 
## 14 39 40 39 38 38 29 14 40 39 31 25  7 39 14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(X)) \{}
\NormalTok{  year \textless{}{-}}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time[i]}
\NormalTok{  country \textless{}{-}}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo[i]}
  \ControlFlowTok{if}\NormalTok{ (year }\OperatorTok{\%\%}\StringTok{ }\DecValTok{1} \OperatorTok{!=}\StringTok{ }\DecValTok{0}\NormalTok{)}
    \ControlFlowTok{for}\NormalTok{ (col }\ControlFlowTok{in} \KeywordTok{c}\NormalTok{(}\StringTok{"DEP"}\NormalTok{, }\StringTok{"CON"}\NormalTok{, }\StringTok{"EMI"}\NormalTok{, }\StringTok{"MAR"}\NormalTok{, }\StringTok{"REN"}\NormalTok{)) \{}
\NormalTok{      prev \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{time}\OperatorTok{==}\NormalTok{(year}\FloatTok{{-}0.5}\NormalTok{) }\OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\NormalTok{country, col]}
\NormalTok{      after \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{time}\OperatorTok{==}\NormalTok{(year}\FloatTok{+0.5}\NormalTok{) }\OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\NormalTok{country, col]}
\NormalTok{      X[i, col] \textless{}{-}}\StringTok{ }\KeywordTok{mean}\NormalTok{(}\KeywordTok{c}\NormalTok{(prev,after),}\DataTypeTok{na.rm=}\NormalTok{T)}
\NormalTok{    \}}
\NormalTok{\}}

\NormalTok{X}\OperatorTok{$}\NormalTok{MAR \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(X}\OperatorTok{$}\NormalTok{MAR,}\DecValTok{1}\NormalTok{)}
\NormalTok{X}\OperatorTok{$}\NormalTok{GAS \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(X}\OperatorTok{$}\NormalTok{GAS,}\DecValTok{2}\NormalTok{)}
\NormalTok{X}\OperatorTok{$}\NormalTok{CON \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(X}\OperatorTok{$}\NormalTok{CON,}\DecValTok{0}\NormalTok{)}
\NormalTok{X}\OperatorTok{$}\NormalTok{EMI \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(X}\OperatorTok{$}\NormalTok{EMI,}\DecValTok{1}\NormalTok{)}
\NormalTok{X}\OperatorTok{$}\NormalTok{GDP \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(X}\OperatorTok{$}\NormalTok{GDP,}\DecValTok{0}\NormalTok{)}
\NormalTok{X}\OperatorTok{$}\NormalTok{REN \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(X}\OperatorTok{$}\NormalTok{REN,}\DecValTok{2}\NormalTok{)}
\NormalTok{X}\OperatorTok{$}\NormalTok{DEP \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(X}\OperatorTok{$}\NormalTok{DEP,}\DecValTok{1}\NormalTok{)}
\NormalTok{X}\OperatorTok{$}\NormalTok{MAR \textless{}{-}}\StringTok{ }\KeywordTok{round}\NormalTok{(X}\OperatorTok{$}\NormalTok{MAR,}\DecValTok{1}\NormalTok{)}

\KeywordTok{rm}\NormalTok{(historic1, historic2, country, after, col, i, outside, prev, year)}
\end{Highlighting}
\end{Shaded}

This system fails to work out only for albania in 2018.5. Just copy and
paste from 2017 for missing values.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\StringTok{"AL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\FloatTok{2018.5}\NormalTok{, }\StringTok{"DEP"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\StringTok{"AL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2017}\NormalTok{, }\StringTok{"DEP"}\NormalTok{]}
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\StringTok{"AL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\FloatTok{2018.5}\NormalTok{, }\StringTok{"CON"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\StringTok{"AL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2017}\NormalTok{, }\StringTok{"CON"}\NormalTok{]}
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\StringTok{"AL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\FloatTok{2018.5}\NormalTok{, }\StringTok{"EMI"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\StringTok{"AL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2017}\NormalTok{, }\StringTok{"EMI"}\NormalTok{]}
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\StringTok{"AL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\FloatTok{2018.5}\NormalTok{, }\StringTok{"MAR"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\StringTok{"AL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2017}\NormalTok{, }\StringTok{"MAR"}\NormalTok{]}
\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\StringTok{"AL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\FloatTok{2018.5}\NormalTok{, }\StringTok{"REN"}\NormalTok{] \textless{}{-}}\StringTok{ }\NormalTok{X[X}\OperatorTok{$}\NormalTok{geo}\OperatorTok{==}\StringTok{"AL"} \OperatorTok{\&}\StringTok{ }\NormalTok{X}\OperatorTok{$}\NormalTok{time }\OperatorTok{==}\StringTok{ }\DecValTok{2017}\NormalTok{, }\StringTok{"REN"}\NormalTok{]}

\KeywordTok{sum}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(X))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0
\end{verbatim}

Now we are not done: we want to go dynamic. We can use dplyr for each
country. we are going to have less rows since first ones are used only
being subtracted from the second ones and then discarded.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d \textless{}{-}}\StringTok{ }\KeywordTok{hash}\NormalTok{()}
\NormalTok{toRemove \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{()}
\NormalTok{U \textless{}{-}}\StringTok{ }\NormalTok{X}
\NormalTok{X}\OperatorTok{$}\NormalTok{geo \textless{}{-}}\StringTok{ }\KeywordTok{as.character}\NormalTok{(X}\OperatorTok{$}\NormalTok{geo)}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(X)) \{}
\NormalTok{  country \textless{}{-}}\StringTok{ }\NormalTok{X[i, }\StringTok{"geo"}\NormalTok{]}
  \ControlFlowTok{if}\NormalTok{ (X[i, }\StringTok{"geo"}\NormalTok{] }\OperatorTok{\%in\%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\KeywordTok{keys}\NormalTok{(d))) \{}
\NormalTok{    U[i,}\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{,}\OperatorTok{{-}}\DecValTok{2}\NormalTok{)] \textless{}{-}}\StringTok{ }\NormalTok{X[i,}\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{,}\OperatorTok{{-}}\DecValTok{2}\NormalTok{)] }\OperatorTok{{-}}\StringTok{ }\NormalTok{d[[country]]}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{toRemove \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(toRemove, i)\}}
\NormalTok{  d[[country]] \textless{}{-}}\StringTok{ }\KeywordTok{c}\NormalTok{(X[i,}\KeywordTok{c}\NormalTok{(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{,}\OperatorTok{{-}}\DecValTok{2}\NormalTok{)])}
\NormalTok{\}}
\NormalTok{X \textless{}{-}}\StringTok{ }\NormalTok{U[}\OperatorTok{{-}}\NormalTok{toRemove,]}
\KeywordTok{rm}\NormalTok{(toRemove, d, U, country)}
\KeywordTok{write.csv}\NormalTok{(X, }\StringTok{"DAT.csv"}\NormalTok{, }\DataTypeTok{row.names=}\NormalTok{F)}
\end{Highlighting}
\end{Shaded}


\end{document}
