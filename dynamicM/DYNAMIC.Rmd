---
title: "FLOW"
author: "Francesco Cabras"
date: "21 April 2020"
output:
  html_document:
    df_print: paged
---
```{r, echo=F}
library(ggpubr)
library(car)
library(eurostat)
library(HDCI)
library(caret)
library(scales)
library(glmnet)
library(lmtest)
library(MASS)
```

Read csv.

```{r}
C <- read.csv("DAT.csv")
train <- C$time < 2015
```

First thing: we notice that the dependent variable is not really gaussian-distributed.

```{r}
ggdensity(C$PRI, main = "Density function PRI")
qqnorm(C$PRI)
qqline(C$PRI)
```
Experiments.

Possible problems with assumptions.

There are certain observations that are having a very strong effect on the model.
Let us go through them. 

```{r}
C[c(125,147),]
```

Observations 147 and 125, respectively the greatest and smallest, are likely to be mistaken, since they both come from Norway in 2003 and 2003.5: we simply decide to ignore them and remove from dataset.

```{r}
C <- C[-c(125,147),]
LM <- lm(log(PRI+1) ~ GAS + DEP + CON + INF + EMI + MAR + REN + GDP + OIL, C, subset=train)
plot(LM)
```

To be checked:
- linearity
- homoskedasticity
- normality of dependent variable
- no perfect multicollinearity

```{r}
vif(LM)
```

No problem for multicollinearity.

Overall check.

```{r}
gvlma::gvlma(LM)
```

Let us try with a box cox transformation.

```{r}
B <- boxcox((PRI+1) ~ GAS + DEP + CON + INF + EMI + MAR + REN + GDP + OIL, data=C, lambda = seq(-2, 9, 1/20))
B
Bb <- cbind(B$x, B$y)
Bb[order(-B$x),][1,]
```

```{r}
LMb <- lm((PRI+1)^(1/9) ~ GAS + DEP + CON + INF + EMI + MAR + REN + GDP + OIL, C)
plot(LMb)
```